if(typeof document!=="undefined"&&!("classList"in document.createElement("a"))){(function(a){"use strict";var b="classList",c="prototype",d=(a.HTMLElement||a.Element)[c],e=Object,f=String[c].trim||function(){return this.replace(/^\s+|\s+$/g,"")},g=Array[c].indexOf||function(a){var b=0,c=this.length;for(;b<c;b++){if(b in this&&this[b]===a){return b}}return-1},h=function(a,b){this.name=a;this.code=DOMException[a];this.message=b},i=function(a,b){if(b===""){throw new h("SYNTAX_ERR","An invalid or illegal string was specified")}if(/\s/.test(b)){throw new h("INVALID_CHARACTER_ERR","String contains an invalid character")}return g.call(a,b)},j=function(a){var b=f.call(a.className),c=b?b.split(/\s+/):[],d=0,e=c.length;for(;d<e;d++){this.push(c[d])}this._updateClassName=function(){a.className=this.toString()}},k=j[c]=[],l=function(){return new j(this)};h[c]=Error[c];k.item=function(a){return this[a]||null};k.contains=function(a){a+="";return i(this,a)!==-1};k.add=function(a){a+="";if(i(this,a)===-1){this.push(a);this._updateClassName()}};k.remove=function(a){a+="";var b=i(this,a);if(b!==-1){this.splice(b,1);this._updateClassName()}};k.toggle=function(a){a+="";if(i(this,a)===-1){this.add(a)}else{this.remove(a)}};k.toString=function(){return this.join(" ")};if(e.defineProperty){var m={get:l,enumerable:true,configurable:true};try{e.defineProperty(d,b,m)}catch(n){if(n.number===-2146823252){m.enumerable=false;e.defineProperty(d,b,m)}}}else if(e[c].__defineGetter__){d.__defineGetter__(b,l)}})(self)}(function(){var a=Math,b=function(a){return a>>0},c=/webkit/i.test(navigator.appVersion)?"webkit":/firefox/i.test(navigator.userAgent)?"Moz":"opera"in window?"O":"",d=/android/gi.test(navigator.appVersion),e=/iphone|ipad/gi.test(navigator.appVersion),f=/playbook/gi.test(navigator.appVersion),g=/hp-tablet/gi.test(navigator.appVersion),h="WebKitCSSMatrix"in window&&"m11"in new WebKitCSSMatrix,i="ontouchstart"in window&&!g,j=c+"Transform"in document.documentElement.style,k=e||f,l=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return setTimeout(a,17)}}(),m=function(){return window.cancelRequestAnimationFrame||window.webkitCancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout}(),n="onorientationchange"in window?"orientationchange":"resize",o=i?"touchstart":"mousedown",p=i?"touchmove":"mousemove",q=i?"touchend":"mouseup",r=i?"touchcancel":"mouseup",s="translate"+(h?"3d(":"("),t=h?",0)":")",u=function(a,b){var d=this,e=document,f;d.wrapper=typeof a=="object"?a:e.getElementById(a);d.wrapper.style.overflow="hidden";d.scroller=d.wrapper.children[0];d.options={hScroll:true,vScroll:true,x:0,y:0,bounce:true,bounceLock:false,momentum:true,lockDirection:true,useTransform:true,useTransition:false,onRefresh:null,onBeforeScrollStart:function(a){a.preventDefault()},onScrollStart:null,onBeforeScrollMove:null,onScrollMove:null,onBeforeScrollEnd:null,onScrollEnd:null,onTouchEnd:null,onDestroy:null};for(f in b)d.options[f]=b[f];d.x=d.options.x;d.y=d.options.y;d.options.useTransform=j?d.options.useTransform:false;d.options.hScrollbar=d.options.hScroll&&d.options.hScrollbar;d.options.vScrollbar=d.options.vScroll&&d.options.vScrollbar;d.options.useTransition=k&&d.options.useTransition;d.scroller.style[c+"TransitionProperty"]=d.options.useTransform?"-"+c.toLowerCase()+"-transform":"top left";d.scroller.style[c+"TransitionDuration"]="0";d.scroller.style[c+"TransformOrigin"]="0 0";if(d.options.useTransition)d.scroller.style[c+"TransitionTimingFunction"]="cubic-bezier(0.33,0.66,0.66,1)";if(d.options.useTransform)d.scroller.style[c+"Transform"]=s+d.x+"px,"+d.y+"px"+t;else d.scroller.style.cssText+=";position:absolute;top:"+d.y+"px;left:"+d.x+"px";d.refresh();d._bind(n,window);d._bind(o);if(!i)d._bind("mouseout",d.wrapper)};u.prototype={enabled:true,x:0,y:0,steps:[],scale:1,handleEvent:function(a){var b=this;switch(a.type){case o:if(!i&&a.button!==0)return;b._start(a);break;case p:b._move(a);break;case q:case r:b._end(a);break;case n:b._resize();break;case"mouseout":b._mouseout(a);break;case"webkitTransitionEnd":b._transitionEnd(a);break}},_resize:function(){this.refresh()},_pos:function(a,d){a=this.hScroll?a:0;d=this.vScroll?d:0;if(this.options.useTransform){this.scroller.style[c+"Transform"]=s+a+"px,"+d+"px"+t+" scale("+this.scale+")"}else{a=b(a);d=b(d);this.scroller.style.left=a+"px";this.scroller.style.top=d+"px"}this.x=a;this.y=d},_start:function(a){var b=this,d=i?a.touches[0]:a,e,f,g;if(!b.enabled)return;if(b.options.onBeforeScrollStart)b.options.onBeforeScrollStart.call(b,a);if(b.options.useTransition)b._transitionTime(0);b.moved=false;b.animating=false;b.zoomed=false;b.distX=0;b.distY=0;b.absDistX=0;b.absDistY=0;b.dirX=0;b.dirY=0;if(b.options.momentum){if(b.options.useTransform){e=getComputedStyle(b.scroller,null)[c+"Transform"].replace(/[^0-9-.,]/g,"").split(",");f=e[4]*1;g=e[5]*1}else{f=getComputedStyle(b.scroller,null).left.replace(/[^0-9-]/g,"")*1;g=getComputedStyle(b.scroller,null).top.replace(/[^0-9-]/g,"")*1}if(f!=b.x||g!=b.y){if(b.options.useTransition)b._unbind("webkitTransitionEnd");else m(b.aniTime);b.steps=[];b._pos(f,g)}}b.startX=b.x;b.startY=b.y;b.pointX=d.pageX;b.pointY=d.pageY;b.startTime=a.timeStamp||Date.now();if(b.options.onScrollStart)b.options.onScrollStart.call(b,a);b._bind(p);b._bind(q);b._bind(r)},_move:function(b){var c=this,d=i?b.touches[0]:b,e=d.pageX-c.pointX,f=d.pageY-c.pointY,g=c.x+e,h=c.y+f,j=b.timeStamp||Date.now();if(c.options.onBeforeScrollMove)c.options.onBeforeScrollMove.call(c,b);c.pointX=d.pageX;c.pointY=d.pageY;if(g>0||g<c.maxScrollX){g=c.options.bounce?c.x+e/2:g>=0||c.maxScrollX>=0?0:c.maxScrollX}if(h>0||h<c.maxScrollY){h=c.options.bounce?c.y+f/2:h>=0||c.maxScrollY>=0?0:c.maxScrollY}c.distX+=e;c.distY+=f;c.absDistX=a.abs(c.distX);c.absDistY=a.abs(c.distY);if(c.absDistX<6&&c.absDistY<6){return}if(c.options.lockDirection){if(c.absDistX>c.absDistY+5){h=c.y;f=0}else if(c.absDistY>c.absDistX+5){g=c.x;e=0}}c.moved=true;c._pos(g,h);c.dirX=e>0?-1:e<0?1:0;c.dirY=f>0?-1:f<0?1:0;if(j-c.startTime>300){c.startTime=j;c.startX=c.x;c.startY=c.y}if(c.options.onScrollMove)c.options.onScrollMove.call(c,b)},_end:function(c){if(i&&c.touches.length!=0)return;var d=this,e=i?c.changedTouches[0]:c,f,g,h={dist:0,time:0},j={dist:0,time:0},k=(c.timeStamp||Date.now())-d.startTime,l=d.x,m=d.y,n;d._unbind(p);d._unbind(q);d._unbind(r);if(d.options.onBeforeScrollEnd)d.options.onBeforeScrollEnd.call(d,c);if(!d.moved){if(i){f=e.target;while(f.nodeType!=1)f=f.parentNode;if(f.tagName!="SELECT"&&f.tagName!="INPUT"&&f.tagName!="TEXTAREA"){g=document.createEvent("MouseEvents");g.initMouseEvent("click",true,true,c.view,1,e.screenX,e.screenY,e.clientX,e.clientY,c.ctrlKey,c.altKey,c.shiftKey,c.metaKey,0,null);g._fake=true;f.dispatchEvent(g)}}d._resetPos(200);if(d.options.onTouchEnd)d.options.onTouchEnd.call(d,c);return}if(k<300&&d.options.momentum){h=l?d._momentum(l-d.startX,k,-d.x,d.scrollerW-d.wrapperW+d.x,d.options.bounce?d.wrapperW:0):h;j=m?d._momentum(m-d.startY,k,-d.y,d.maxScrollY<0?d.scrollerH-d.wrapperH+d.y:0,d.options.bounce?d.wrapperH:0):j;l=d.x+h.dist;m=d.y+j.dist;if(d.x>0&&l>0||d.x<d.maxScrollX&&l<d.maxScrollX)h={dist:0,time:0};if(d.y>0&&m>0||d.y<d.maxScrollY&&m<d.maxScrollY)j={dist:0,time:0}}if(h.dist||j.dist){n=a.max(a.max(h.time,j.time),10);d.scrollTo(b(l),b(m),n);if(d.options.onTouchEnd)d.options.onTouchEnd.call(d,c);return}d._resetPos(200);if(d.options.onTouchEnd)d.options.onTouchEnd.call(d,c)},_resetPos:function(a){var b=this,c=b.x>=0?0:b.x<b.maxScrollX?b.maxScrollX:b.x,d=b.y>=0||b.maxScrollY>0?0:b.y<b.maxScrollY?b.maxScrollY:b.y;if(c==b.x&&d==b.y){if(b.moved){if(b.options.onScrollEnd)b.options.onScrollEnd.call(b);b.moved=false}return}b.scrollTo(c,d,a||0)},_mouseout:function(a){var b=a.relatedTarget;if(!b){this._end(a);return}while(b=b.parentNode)if(b==this.wrapper)return;this._end(a)},_transitionEnd:function(a){var b=this;if(a.target!=b.scroller)return;b._unbind("webkitTransitionEnd");b._startAni()},_startAni:function(){var b=this,c=b.x,d=b.y,e=Date.now(),f,g,h;if(b.animating)return;if(!b.steps.length){b._resetPos(400);return}f=b.steps.shift();if(f.x==c&&f.y==d)f.time=0;b.animating=true;b.moved=true;if(b.options.useTransition){b._transitionTime(f.time);b._pos(f.x,f.y);b.animating=false;if(f.time)b._bind("webkitTransitionEnd");else b._resetPos(0);return}h=function(){var i=Date.now(),j,k;if(i>=e+f.time){b._pos(f.x,f.y);b.animating=false;if(b.options.onAnimationEnd)b.options.onAnimationEnd.call(b);b._startAni();return}i=(i-e)/f.time-1;g=a.sqrt(1-i*i);j=(f.x-c)*g+c;k=(f.y-d)*g+d;b._pos(j,k);if(b.animating)b.aniTime=l(h)};h()},_transitionTime:function(a){this.scroller.style[c+"TransitionDuration"]=a+"ms"},_momentum:function(c,d,e,f,g){var h=6e-4,i=a.abs(c)/d,j=i*i/(2*h),k=0,l=0;if(c>0&&j>e){l=g/(6/(j/i*h));e=e+l;i=i*e/j;j=e}else if(c<0&&j>f){l=g/(6/(j/i*h));f=f+l;i=i*f/j;j=f}j=j*(c<0?-1:1);k=i/h;return{dist:j,time:b(k)}},_offset:function(a){var b=-a.offsetLeft,c=-a.offsetTop;while(a=a.offsetParent){b-=a.offsetLeft;c-=a.offsetTop}return{left:b,top:c}},_bind:function(a,b,c){(b||this.scroller).addEventListener(a,this,!!c)},_unbind:function(a,b,c){(b||this.scroller).removeEventListener(a,this,!!c)},destroy:function(){var a=this;a.scroller.style[c+"Transform"]="";a._unbind(n,window);a._unbind(o);a._unbind(p);a._unbind(q);a._unbind(r);a._unbind("mouseout",a.wrapper);if(a.options.useTransition)a._unbind("webkitTransitionEnd");if(a.options.onDestroy)a.options.onDestroy.call(a)},refresh:function(){var a=this,b;a.wrapperW=a.wrapper.clientWidth;a.wrapperH=a.wrapper.clientHeight;a.scrollerW=a.scroller.offsetWidth;a.scrollerH=a.scroller.offsetHeight;a.maxScrollX=a.wrapperW-a.scrollerW;a.maxScrollY=a.wrapperH-a.scrollerH;a.dirX=0;a.dirY=0;a.hScroll=a.options.hScroll&&a.maxScrollX<0;a.vScroll=a.options.vScroll&&(!a.options.bounceLock&&!a.hScroll||a.scrollerH>a.wrapperH);b=a._offset(a.wrapper);a.wrapperOffsetLeft=-b.left;a.wrapperOffsetTop=-b.top;a.scroller.style[c+"TransitionDuration"]="0";a._resetPos(200)},scrollTo:function(a,b,c,d){var e=this,f=a,g,h;e.stop();if(!f.length)f=[{x:a,y:b,time:c,relative:d}];for(g=0,h=f.length;g<h;g++){if(f[g].relative){f[g].x=e.x-f[g].x;f[g].y=e.y-f[g].y}e.steps.push({x:f[g].x,y:f[g].y,time:f[g].time||0})}e._startAni()},scrollToElement:function(b,c){var d=this,e;b=b.nodeType?b:d.scroller.querySelector(b);if(!b)return;e=d._offset(b);e.left+=d.wrapperOffsetLeft;e.top+=d.wrapperOffsetTop;e.left=e.left>0?0:e.left<d.maxScrollX?d.maxScrollX:e.left;e.top=e.top>0?0:e.top<d.maxScrollY?d.maxScrollY:e.top;c=c===undefined?a.max(a.abs(e.left)*2,a.abs(e.top)*2):c;d.scrollTo(e.left,e.top,c)},disable:function(){this.stop();this._resetPos(0);this.enabled=false;this._unbind(p);this._unbind(q);this._unbind(r)},enable:function(){this.enabled=true},stop:function(){m(this.aniTime);this.steps=[];this.moved=false;this.animating=false}};if(typeof exports!=="undefined")exports.iScroll=u;else window.iScroll=u})();var app=app||{};app.utility=app.utility||{};app.utility.validator={isEmpty:function(a){if(a==""||a==null||a===false){return true}return false},isTypeOf:function(a,b){if(typeof b=="string"){if(typeof a==b){return true}}else{if(a instanceof b){return true}}return false}};var app=app||{};app.utility=app.utility||{};app.utility.layout=function(){var a=function(){[].forEach.call(document.getElementsByClassName("deck"),function(a){a.style.height=document.body.offsetHeight-document.getElementById("taskbar").offsetHeight+"px"})};var b;window.addEventListener("resize",function(){clearTimeout(b);b=setTimeout(function(){a()},100)});a()}();var app=app||{};app.utility=app.utility||{};app.utility.deck=function(){var a=document.getElementsByClassName("card");return{showCard:function(a){document.getElementById(a).classList.add("active")},hideCard:function(a){document.getElementById(a).classList.remove("active")},hideAllCards:function(){for(var b=0;b<a.length;b++){a[b].classList.remove("active")}}}}();var app=app||{};app.utility=app.utility||{};app.utility.jsonp=function(a,b){var c=a+"&callback="+b;var d=document.createElement("script");d.src=c;d.async="async";d.onload=d.onreadystatechange=function(a){console.log(a.target);var b=document.head.removeChild(a.target);b=null};this.send=function(){document.head.appendChild(d)}};var app=app||{};app.type=app.type||{};app.type.format=function(a,b,c){var d,e,f,g=this;this.init=function(){this.setName(a);this.setFormat(b);this.setMime(c)};this.getName=function(){return d};this.setName=function(a){d=a};this.getFormat=function(){return e};this.setFormat=function(a){e=a};this.getMime=function(){return f};this.setMime=function(a){f=a};this.init()};var app=app||{};app.type=app.type||{};app.type.releaseDate=function(a,b){var c,d;this.init=function(){this.setDvd(b);this.setCinema(a)};this.getDvd=function(){return c};this.setDvd=function(a){c=a};this.getCinema=function(){return d};this.setCinema=function(a){d=a};this.init()};var app=app||{};app.model=app.model||{};app.model.actor=function a(a,b){var c,d,e=this;this.init=function(){this.setName(a);this.setRole(b)};this.getName=function(){return c};this.setName=function(a){c=a};this.getRole=function(){return d};this.setRole=function(a){d=a};this.init()};var app=app||{};app.model=app.model||{};app.model.movie=function b(a,b,c,d){var e,f,g,h,i,j=[],k=[],l,m=false,n=this;this.init=function(){this.setTitle(a);this.setRtid(b);this.setPosterframe(c);this.setSynopsis(d)};this.getTitle=function(){return e};this.setTitle=function(a){e=a};this.getRtid=function(){return f};this.setRtid=function(a){f=a};this.getPosterframe=function(){return g};this.setPosterframe=function(a){g=a};this.getSynopsis=function(){return h};this.setSynopsis=function(a){if(app.utility.validator.isEmpty(a)){h=null}else{h=a}};this.getVideos=function(){return j};this.setVideos=function(a){j.length=0;for(var b=0;b<a.length;b++){n.addVideo(a[b])}};this.addVideo=function(a){j.push(a)};this.getActors=function(){return k};this.getActor=function(a){return k[a]};this.setActors=function(a){k.length=0;for(var b=0;b<a.length;b++){n.addActor(a[b])}};this.addActor=function(a){k.push(a)};this.setReleaseDate=function(a){i=a};this.getReleaseDate=function(){return i};this.getRating=function(){return l};this.setRating=function(a){l=a};this.isFavourite=function(){return m};this.setFavourite=function(a){if(a===true){m=true}else{m=false}};this.init()};var app=app||{};app.model=app.model||{};app.model.video=function c(a,b,c){var d,e,f,g=[],h=this,i=app.utility.validator;this.init=function(){this.setTitle(a);this.setLength(b);this.setPosterframe(c)};this.getTitle=function(){return d};this.setTitle=function(a){d=a};this.getLength=function(){return e};this.setLength=function(a){if(!i.isTypeOf(a,"number")){throw{message:"The source property in the video model requires an 'Array' type",type:"validation_exception"};return}e=a};this.getSources=function(){return g};this.getSource=function(a){return g[a]};this.removeSource=function(a){if(!i.isTypeOf(a,"number")){throw{message:"The source property in the video model requires an 'Array' type",type:"validation_exception"};return}g.splice(a,1)};this.setSources=function(a){if(!i.isTypeOf(a,Array)){throw{message:"The source property in the video model requires an 'Array' type",type:"validation_exception"};return}g.length=0;for(var b=0;b<a.length;b++){h.addSource(a[b])}};this.addSource=function(a){g.push(a)};this.init()};var app=app||{};app.model=app.model||{};app.model.videosource=function d(a,b){var c,d,e=this,f=app.utility.validator;this.init=function(){this.setUrl(a);this.setFormat(b)};this.getUrl=function(){return c};this.setUrl=function(a){if(!f.isTypeOf(a,"string")){throw{message:"The url property in the videosource model requires a 'string' type",type:"validation_exception"};return}c=a};this.getFormat=function(){return d};this.setFormat=function(a){if(!f.isTypeOf(a,app.type.format)){throw{message:"The format property in the videosource model requires a 'app.type.format' type",type:"validation_exception"};return}d=a};this.init()};var app=app||{};app.view=app.view||{};app.view.movie=function(a){var b=document.createElement("div");b.innerHTML=['<header class="movie-header">','<img src="',a.getPosterframe(),'" alt="',a.getTitle(),'" class="poster" width="100%" />','<hgroup class="movie-title">','<a href="#" class="btn-favourite add" data-controller="favourites" data-action="add" data-params=\'{"id": "',a.getRtid(),'", "title": "',escape(a.getTitle()),'", "synopsis": "',escape(a.getSynopsis()),'", "posterframe": "',a.getPosterframe(),"\"}'>favourite</a>","<h2>",a.getTitle(),"</h2>",'<p class="movie-release-date">Cinematic Release - ',a.getReleaseDate().getCinema().getDate(),"/",a.getReleaseDate().getCinema().getMonth()+1,"/",a.getReleaseDate().getCinema().getFullYear(),"</p>","</hgroup>","</header>",'<div class="movie-content">','<div class="block-container span-three">','<section class="block" id="block-synopsis">','<div class="content">',"<p>",a.getSynopsis(),"</p>","</div>","</section>",'<section class="block" id="block-cast">','<div class="content">',"<h3>Cast List</h3>",'<ul class="list scrolling medium"></ul>',"</div>","</section>",'<section class="block" id="block-video">','<div class="content">',"<h3>Video Clips</h3>",'<ul class="list grid"></ul>',"</div>","</section>","</div>","</div>",'<footer class="movie-footer screenbar">','<a class="back" href="/" data-controller="favourites" data-action="list">my favourites</a>',"</footer>"].join("");if(a.isFavourite()){var c=b.querySelector("a.btn-favourite");c.setAttribute("data-action","remove");c.classList.remove("add");c.classList.add("remove");c.textContent="un-favourite"}for(var d=0;d<a.getActors().length;d++){var e=a.getActor(d);var f=document.createElement("li");f.innerHTML=["<p>",e.getName(),"<br />","<em>",e.getRole(),"</em></p>"].join("");b.querySelector("#block-cast ul.list").appendChild(f)}this.render=function(){return b}};var app=app||{};app.view=app.view||{};app.view.movielistitem=function(a){var b=a,c=document.createElement("li");c.innerHTML=['<a data-controller="movies" data-action="find" data-params="{"id": "',a.getRtid(),'"}" class="more" href="movie/view/',a.getRtid(),'">','<div class="preview-image">','<img src="',a.getPosterframe(),'" alt="',a.getTitle(),'" height="82" />',"</div>","<h2>",a.getTitle(),"</h2>","<p>",a.getSynopsis(),"</p>","</a>"].join("");this.render=function(){return c}};var app=app||{};app.view=app.view||{};app.view.movielist=function(a){var b=a,c;c=document.createElement("ul");c.classList.add("list");c.classList.add("alternating");c.classList.add("medium");c.classList.add("video-list");for(var d=0;d<a.length;d++){var e=new app.view.movielistitem(a[d]);c.appendChild(e.render())}this.render=function(){return c}};var app=app||{};app.controller=app.controller||{};app.controller.movies=function(){var a=this,b=document.querySelector('#add-movie input[name="query"]'),c=document.getElementById("add-movie"),d=document.getElementById("card-movie_search_results"),e,f=[],g=null;this.init=function(){this.bindSearchForm()};this.bindSearchForm=function(){b.addEventListener("focus",function(){if(this.value.length>0){app.utility.deck.showCard("card-movie_search_results")}});c.addEventListener("submit",function(c){c.preventDefault();clearTimeout(e);var d=b.value;if(d.length>0){a.search(d)}});b.addEventListener("input",function(){var b=this.value;clearTimeout(e);if(b.length>0){document.getElementById("taskbar").classList.add("searchactive")}else{document.getElementById("taskbar").classList.remove("searchactive")}e=setTimeout(function(){a.search(b)},1e3)})};this.clearSearch=function(){clearTimeout(e);b.value="";app.utility.deck.hideCard("card-movie_search_results");evt=document.createEvent("HTMLEvents");evt.initEvent("input",true,false);b.dispatchEvent(evt)};this.find=function(a){if(typeof a.id==="undefined"){throw"No ID supplied to find action in view controller";return}var b=new app.utility.jsonp("http://api.rottentomatoes.com/api/public/v1.0/movies/"+a.id+".json?apikey=57t3sa6sp5zz5394btptp9ew",'app.bootstrap.getController("movies").view');b.send()};this.view=function(a){if(!app.utility.validator.isTypeOf(a,"object")){return}var b=new app.model.movie(a.title,a.id,a.posters.original,a.synopsis),c=document.getElementById("card-movie_info");var d=new app.type.releaseDate(new Date(a.release_dates.theater),new Date(a.release_dates.dvd));b.setReleaseDate(d);b.setRating(a.mpaa_rating);var e=JSON.parse(localStorage.favourites);for(var h=0;h<e.length;h++){if(e[h].id==b.getRtid()){b.setFavourite(true)}}for(var h=0;h<a.abridged_cast.length;h++){var i=a.abridged_cast[h],j=typeof i.characters==="undefined"?"":i.characters[0];var k=new app.model.actor(i.name,j);b.addActor(k)}var l=new app.view.movie(b);c.innerHTML=l.render().innerHTML;f.push(new iScroll(c.querySelector(".movie-content"),{vScroll:false,vScrollbar:false}));[].forEach.call(c.getElementsByClassName("content"),function(a){f.push(new iScroll(a,{hScroll:false,hScrollbar:false}))});window.addEventListener("resize",function(){setTimeout(function(){g.refresh();for(var a=0;a<_scrolls.length;a++){f[a].refresh()}},100)});app.utility.deck.hideAllCards();app.utility.deck.showCard("card-movie_info")};this.search=function(a){if(a.length>0){a=encodeURIComponent(a);var c=new app.utility.jsonp("http://api.rottentomatoes.com/api/public/v1.0/movies.json?apikey=57t3sa6sp5zz5394btptp9ew&q="+a,'app.bootstrap.getController("movies").showSearchResults');c.send();b.classList.add("loading")}};this.showSearchResults=function(a){var c=[];for(var e=0;e<a.movies.length;e++){var f=a.movies[e];var h=f.title||"",i=f.id,j=f.posters.original||"",k=f.synopsis||"";c.push(new app.model.movie(h,i,j,k))}var l=new app.view.movielist(c);d.innerHTML="";d.appendChild(l.render());d.classList.add("active");b.classList.remove("loading");c=null;if(g!==null){g.destroy();g=null}g=new iScroll(d)};this.init()};var app=app||{};app.controller=app.controller||{};app.controller.favourites=function(){var a=null;this.init=function(){};this.add=function(a){var b=a;var c=JSON.parse(localStorage.favourites);for(var d=0;d<c.length;d++){if(c[d].id==b.id){return}}if(this.nodeName=="A"){this.setAttribute("data-action","remove");this.classList.remove("add");this.classList.add("remove");this.textContent="un-favourite"}c.push(b);localStorage.favourites=JSON.stringify(c)};this.list=function(){var b=JSON.parse(localStorage.favourites),c=[],d=document.getElementById("card-favourite_list");for(var e=b.length;e>0;e--){var f=b[e-1];c.push(new app.model.movie(unescape(f.title),f.id,f.posterframe,unescape(f.synopsis)))}var g=new app.view.movielist(c);d.innerHTML="";d.appendChild(g.render());if(a!==null){a.destroy();a=null}a=new iScroll(d);app.utility.deck.hideAllCards();app.utility.deck.showCard("card-favourite_list")};this.remove=function(a){var b=a.id;var c=JSON.parse(localStorage.favourites);for(var d=0;d<c.length;d++){if(c[d].id==b){c.splice(d,1)}}localStorage.favourites=JSON.stringify(c);if(this.nodeName=="A"){this.setAttribute("data-action","add");this.classList.remove("remove");this.classList.add("add");this.textContent="favourite"}};this.init()};var app=app||{};app.bootstrap=function(){var a={movies:null,favourites:null};document.addEventListener("click",function(b){var c=b.target;while(c.nodeName!=="A"&&c.getAttribute("data-controller")==null&&c.getAttribute("data-action")==null){if(c.parentNode.nodeName=="HTML"){c=null;break}c=c.parentNode}if(c){b.preventDefault();var d=c.getAttribute("data-controller"),e=c.getAttribute("data-action"),f=c.getAttribute("data-params");if(typeof a[d]==="undefined"||typeof a[d][e]==="undefined"){throw"Action "+e+" for controller "+d+" doesn't appear to exist";return}if(f){try{f=JSON.parse(f)}catch(g){f=null;return}}a[d][e].call(c,f)}});if(!localStorage.getItem("favourites")){var b=[];localStorage.favourites=JSON.stringify(b)}return{getController:function(b){var c=b.split(".");var d=null;if(c.length>0){d=a;for(var e=0;e<c.length;e++){d=d[c[e]]}}return d},initScripts:function(){a.movies=new app.controller.movies;a.favourites=new app.controller.favourites;a.favourites.list()}}}()